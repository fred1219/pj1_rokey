# Auto Weld: ROS2 기반 용접 협동 로봇 자동화 시스템

**ROS 2 기반으로, 두산 협동로봇(M0609)을 활용하여 근로자와 협력할 수 있도록 설계되어, 작업 환경에서 안전하게 상호작용하며 인간의 업무를 보조해주는 역할을 구현하고자 했습니다.**
**2D/3D 용접 자동화 및 충돌 감지 안전 기능을 구현한 ROS2 기반 협동로봇 시스템을 구축했습니다.**

- 📅 **개발 기간**: 2025.05.14 ~ 05.21 (8일)
- 🧑‍🤝‍🧑 **인원 구성**: 4명  
  **(본인 역할: 3D 용접 자동화 시스템 설계, ROS 노드 연동 및 통합 테스트)**
- 🛠 **사용 기술**: ROS 2, Doosan dsr 패키지
- ✅ **주요 기능**: 2D/3D 용접 자동화, 예외 처리 및 안전 정지
- 
### 🎥 시연 영상

[![시연 영상 보기](https://img.youtube.com/vi/GI565ckTv_A/0.jpg)](https://youtu.be/GI565ckTv_A)

📄 [PDF 소개 자료](링크)  
💻 [GitHub 소스코드](링크)

## 📑 프로젝트 개요

- **주제**: Auto Weld (용접 협동 보조 로봇)
- **목표**: 
- **팀원**: 4명

**🧑‍🤝‍🧑 팀원 역할 분담**
>|이름       |	역할      |
>|-----------|------------|
>|**이세현(작성자)**|	**규칙적 3D 용접 시스템 구현 및 원호 계산**|
>|이하빈|	불규칙적 2D 용접 경로 추출 및 좌표 변환|
>|홍진규|	Force 센서 기반 안전 기능 및 정지 제어|
>|최정호(팀장)|	규칙적 2D 용접 경로 구현|

프로젝트는 팀원 전체의 협업을 바탕으로 진행되었으며, 핵심 기능은 역할에 따라 분담하여 개발
<br>

**📅 작업 일정**
>| 기간 | 작업 내용 |
>|------|-----------|
>| 5/14 ~ 5/15 | 기획 및 주제 선정 |
>| 5/15 ~ 5/16 | 자료조사 및 레퍼런스 분석 |
>| 5/17 ~ 5/18 | 기능별 코드 개발 |
>| 5/19 ~ 5/20 | 중간 점검 및 통합 |
>| 5/20 ~ 5/21 | 최종 테스트 및 시연 준비 |
>| 총 개발 기간 | 8일 (5/14 ~ 5/21) |

---

## 1. 개발 배경 및 기획


### 🔧 핵심 기능

-  **규칙적 2D 용접**: 시작점과 도착점을 교시하여 직선 이동  
-  **불규칙 2D 용접**: 이미지 기반 경로 추출 → 좌표 스케일링 → CSV 기반 자동 이동  
-  **규칙적 3D 용접**: 3점 캡처 → 원 중심/반지름 계산 → movec 활용 경로 이동  
-  **충돌 감지 기능**: force 센서 값을 기반으로 경고음, 팝업, 로봇 정지 동작 실행

### 전체 요약

| 코드명            | 주요 기능 및 역할                                                                 | 특징                            |
| -------------- | -------------------------------------------------------------------------- | ----------------------------- |
| a\_home.py     | 3개 좌표 기록, 원호 중심 및 반지름 계산, 원호 용접 경로 생성, 홈 위치 이동                             | 수학적 경로 계산 및 경로 계획             |
| movec.py       | CSV 기반 3점 원호 경로로 로봇 movel, movec 명령 실행                                     | 규칙적 3D 원호 경로 제어               |
| 2d\_safe.py    | GUI 이미지 선택 → 스켈레톤 좌표 추출 →<br> 경로 샘플링 및 시각화 → 경로 따라 movel 실행 → 충격 감지 및 안전 정지 | 불규칙 2D 경로 용접 + 충격 감지 안전 기능 포함 |
| 2d\_ui.py      | tkinter GUI로 좌표 캡처, 경로 시각화, 저장 및 원호 경로 계산 지원                               | 사용자 인터페이스 제공, 경로 준비 보조        |
| 2d\_control.py | ROS2 토픽으로 좌표 수신, movej/movel 명령으로 2D 좌표 간 이동 반복 실행                         | ROS2 통신 기반 좌표 수신 및 반복 이동 제어   |

---

## 2. 사용 장비 & 기술 스택

## 3. 주요 기능 구현 과정

### 🟦 3-1. 규칙적 2D 용접접

> 좌표 캡처 UI와 제어 노드를 분리 구성한 형태<br>
> **사용 코드:** `ui_node.py`, `control_node.py`

#### 🔹 `ui_node.py`

* **역할:**
  사용자가 GUI로 3개의 좌표를 캡처 → 계산된 중심 좌표/반지름/포인트 전송

---

#### 🔹 `control_node.py`

* **역할:**
  `ui_node`로부터 받은 포인트를 바탕으로 실제 원호 경로를 생성하고 `movec` 제어

---

### 🟥 3-2. 불규칙적 2D 용접접

> movec 동작 중 충격 감지를 병렬 스레드로 수행하는 안전 제어<br>
> **사용 코드:** `2d_safe.py`

#### 🔹 `2d_safe.py`

* **역할:**
  사용자가 입력한 arc 경로로 `movec()` 수행 중, `monitor_impact`로 충격 감지

---

### 🟩 3-3. 규칙적 3D 용접 (원호 용접)

> 실제 좌표 캡처 → CSV 저장 → 파일 불러와 원호 경로 수행<br>
> **사용 코드:** `a_home.py`, `movec.py`

#### 🔹 `a_home.py`

* **역할:**

  * 작업 전 홈 위치로 이동
  * 사용자 조작으로 3개 좌표 캡처
  * `captured_robot_points.csv`에 저장
  * 중심점/반지름/평면 방향 계산하여 **movec 가능 여부 판단**

---

#### 🔹 `movec.py`

* **역할:**

  * `a_home.py`가 저장한 CSV 파일을 읽어
    **P3(시작점) → P2(경유) → P1(도착점)** 경로로 **원호 움직임 수행**
  * 실제 원호 용접 작업을 수행하는 메인 실행 코드
 
---

## 4. 핵심 코드 구현

### 1. `2d_safe.py`

**역할**

* 사용자로부터 이미지를 입력받아 용접 경로 좌표를 추출 및 시각화
* 추출된 좌표를 CSV 파일로 저장하고 기록 유지
* 저장된 좌표를 불러와 로봇에 `movel` 명령으로 경로 이동 실행
* 이동 중 툴 힘 센서를 모니터링하여 충격 발생 시 경고음 및 팝업 표시
* 충격 감지 시 Z축 오프셋을 적용해 로봇을 상승시키고 작업 중단

**ROS2 구성**

* **노드명**: `rokey_simple_move` (namespace: `dsr01`)
* **구독 토픽**: 없음 (툴 힘 센서 값, 현재 위치는 DSR API 함수 호출로 직접 획득)
* **발행 토픽**: 없음
* **서비스/액션**: 없음
* **기타**:

  * `rclpy.init()`, `rclpy.create_node()`로 노드 생성
  * `DR_init.__dsr__node`로 DSR API 연동 후 `movel` 명령 실행
  * ROS2 스핀 없이 단순 실행
  * 종료 시 `rclpy.shutdown()` 호출

---

### 2. `2d_ui.py`

**역할**

* `/dsr01/msg/current_posx` 토픽을 구독하여 현재 로봇 TCP 좌표 수신
* GUI 버튼 클릭 시 현재 좌표를 `posx_2`, `posx_3`로 저장
* 저장된 두 좌표를 `/saved_posx_pair` 토픽으로 발행
* `/dsr01/system/set_robot_mode` 서비스로 로봇 모드 변경 요청
* Tkinter GUI와 ROS2 노드를 병렬로 실행하여 제어

**ROS2 구성**

* **노드명**:

  * 구독/발행: `PosTopicSubscriber`
  * 서비스 클라이언트: `service_client_node`
* **구독 토픽**:

  * `/dsr01/msg/current_posx` (`Float64MultiArray`)
* **발행 토픽**:

  * `/saved_posx_pair` (`Float64MultiArray`)
* **서비스 클라이언트**:

  * `/dsr01/system/set_robot_mode` (`dsr_msgs2/srv/SetRobotMode`)
* **기타**:

  * `rclpy.init()` 및 `rclpy.shutdown()` 사용
  * `rclpy.spin()`은 구독 노드에서만 별도 스레드로 실행

---

### 3. `2d_control.py`

**역할**

* `/saved_posx_pair` 토픽에서 두 개의 posx 좌표 배열 수신
* 수신된 좌표를 순차적으로 `movej`, `movel` 명령으로 이동
* 이동 완료 후 초기 위치로 복귀
* 한 번의 데이터 수신 후 처리하고 대기

**ROS2 구성**

* **노드명**: `posx_mover` (namespace: `dsr01`)
* **구독 토픽**: `/saved_posx_pair` (`Float64MultiArray`)
* **발행 토픽**: 없음
* **서비스/액션**: 없음
* **기타**:

  * `rclpy.init()` 및 `rclpy.create_node()`로 노드 생성
  * `DR_init.__dsr__node`를 통해 DSR API 연동 후 명령 실행
  * `rclpy.spin_once()`로 데이터 수신 처리
  * 종료 시 `rclpy.shutdown()` 호출

---

### 4. `a_home.py`

**역할**

* 로봇을 홈 위치로 `movej` 명령으로 이동
* TCP 좌표 3개를 캡처하여 저장
* 3개의 좌표로 원의 중심과 반지름 계산
* GUI에서 실시간 좌표 모니터링, 캡처, 계산, 저장 기능 제공
* 로봇 모드 변경 서비스 호출 기능 포함

**ROS2 구성**

* **노드명**: `welding_move` (namespace: `dsr01`)
* **구독 토픽**:

  * `/dsr01/msg/current_posx` (`Float64MultiArray`)
  * `/dsr01/msg/joint_state` (`Float64MultiArray`)
* **발행 토픽**: 없음
* **서비스 클라이언트**:

  * `/dsr01/system/set_robot_mode` (`dsr_msgs2/srv/SetRobotMode`)
* **기타**:

  * GUI와 ROS2를 함께 실행
  * 로컬 계산과 로봇 제어를 병행

---

### 5. `movec.py`

**역할**

* CSV 파일에서 3개의 포인트(P1, P2, P3) 좌표 읽기
* P3으로 직선 이동(`movel`)
* P2 경유 후 P1로 원호 이동(`movec`)
* 툴과 TCP 설정 후 이동 명령 실행
* 예외 처리와 ROS2 노드 생성·종료 관리 포함

**ROS2 구성**

* **노드명**: `movec` (namespace: `dsr01`)
* **구독 토픽**: 없음 (좌표는 CSV에서 직접 읽음)
* **발행 토픽**: 없음
* **서비스/액션**: 없음
* **기타**:

  * `rclpy.init()` 및 `rclpy.create_node()`로 노드 생성
  * `DR_init.__dsr__node`로 DSR API 연동
  * 종료 시 `rclpy.shutdown()` 호출

---

## 5. 도전 과제와 문제 해결 방법

---

## 6. 협업 내용 및 진행 과정

### 🤝 협업 내용

#### 📌 협업 포인트

### 진행 과정


---

## 7. 성과 및 결과물


---

## 8. 프로젝트 결과


---

## 9. 개인적 성찰 및 배운 점



---

## 10. 개선 및 확장 아이디어
